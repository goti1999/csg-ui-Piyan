SELECT
    d.[CustomerID] AS d_CustomerID,
    d.[MBL_ID] AS d_MBL_ID,
    d.[ContainerID] AS d_ContainerID,
    d.[Status] AS d_Status,
    d.[TransmissionTimestamp] AS d_TransmissionTimestamp,
    d.[Voyage] AS d_Voyage,
    d.[ContainerSize] AS d_ContainerSize,
    d.[Broker] AS d_Broker,
    d.[Carrier] AS d_Carrier,
    d.[Vessel] AS d_Vessel,
    d.[PortOfDischarge_Lima] AS d_PortOfDischarge_Lima,
    d.[ETA_PortOfDischarge] AS d_ETA_PortOfDischarge,
    d.[PackingMethod] AS d_PackingMethod,
    d.[TotalWeight] AS d_TotalWeight,
    d.[AdvertFlag] AS d_AdvertFlag,
    d.[RealAdvertFlag] AS d_RealAdvertFlag,
    d.[EarliestAdvertDate] AS d_EarliestAdvertDate,
    d.[EarliestRealAdvertDate] AS d_EarliestRealAdvertDate,
    d.[todo] AS d_todo,
    d.[last_eventID] AS d_last_eventID,
    d.[PortOfLoading_Lima] AS d_PortOfLoading_Lima,
    d.[ETD_PortOfLoading] AS d_ETD_PortOfLoading,
    d.[Terminal_Inland_Vorgabe_NTL] AS d_Terminal_Inland_Vorgabe_NTL,
    d.[ETA_Terminal_Inland] AS d_ETA_Terminal_Inland,
    d.[DeliveryAddress] AS d_DeliveryAddress,
    d.[ETA_DeliveryAddress] AS d_ETA_DeliveryAddress,
    d.[Transport_Mode_Terminal] AS d_Transport_Mode_Terminal,
    d.[Transport_Mode_Terminal_Vorgabe_NTL] AS d_Transport_Mode_Terminal_Vorgabe_NTL,
    d.[Transport_Mode_final_DeliveryAddress] AS d_Transport_Mode_final_DeliveryAddress,
    d.[ATA_DeliveryAddress] AS d_ATA_DeliveryAddress,
    d.[Terminal_Inland_CundA] AS Terminal_Inland_CundA,
    d.[transport_Dispo_ID] AS d_transport_Dispo_ID,
    d.[Condition] AS d_Condition,
    d.[into_CW1] AS d_into_CW1,
    d.[to_Customer] AS d_to_Customer,
    d.[to_Transporter] AS d_to_Transporter,
    d.[DropOff_Terminal] AS d_DropOff_Terminal,
    d.[Terminal_PortOfDischarge] AS d_Terminal_PortOfDischarge,
    d.[Pincode] AS d_Pincode,
    d.[DropOff_Terminal_TIR] AS d_DropOff_Terminal_TIR,
    d.[Delivered] AS d_Delivered,
    d.[Remarks] AS d_Remarks,
    d.[HouseBill] AS d_HouseBill,
    d.[Containerverfuegbarkeit] AS d_Containerverfuegbarkeit,
    d.[ETA_Service_Provider] AS d_ETA_Service_Provider,
    d.[ATA_Terminal_Inland] AS d_ATA_Terminal_Inland,
    d.[ATD_Terminal_Inland] AS d_ATD_Terminal_Inland,
    d.[Return_Date_to_Depot] AS d_Return_Date_to_Depot,
    d.[ATD_Seaport] AS d_ATD_Seaport,
    d.[ETD_Seaport] AS d_ETD_Seaport,
    d.[ETA_Seaport] AS d_ETA_Seaport,
    d.[ATA_Seaport] AS d_ATA_Seaport,
    d.[final_date_delivery_address] AS d_final_date_delivery_address,
    d.[ctv_booking_id] AS d_ctv_booking_id,
    d.[CTV_ETA_PortOfDischarge] AS d_CTV_ETA_PortOfDischarge,
    d.[PortOfDischarge_UNLOCO] AS d_PortOfDischarge_UNLOCO,
    d.[PortOfLoading_UNLOCO] AS d_PortOfLoading_UNLOCO,
    d.[ATA_DropOff_Terminal] AS d_ATA_DropOff_Terminal,
    d.[DeliveryAddress_CTV] AS d_DeliveryAddress_CTV,
    d.[PortOfDischarge_UNLOCO_CTV] AS d_PortOfDischarge_UNLOCO_CTV,
    d.[Transport_Mode_Terminal_CTV] AS d_Transport_Mode_Terminal_CTV,
    d.[Carrier_CTV] AS d_Carrier_CTV,
    d.[customs_document_number] AS d_customs_document_number,
    d.[customs_document_type] AS d_customs_document_type,
    d.[Terminal_Inland_CTV] AS d_Terminal_Inland_CTV,
    d.[ETD_Pickup_PortOfDischarge] AS d_ETD_Pickup_PortOfDischarge,
    d.[ATD_Pickup_PortOfDischarge] AS d_ATD_Pickup_PortOfDischarge,
    d.[pinRequested] AS d_pinRequested,
    d.[pinState] AS d_pinState,
    d.[nationalTransportState] AS d_nationalTransportState,
    d.[finalDeliveryState] AS d_finalDeliveryState,
    d.[emptyReturnState] AS d_emptyReturnState,
    d.[ETA_Terminal_Inland_Vorgabe_NTL] AS d_ETA_Terminal_Inland_Vorgabe_NTL,
    d.[DeliveryInfo_send_to_CTV] AS d_DeliveryInfo_send_to_CTV,
    d.[new] AS d_new,
    d.Direct_Truck AS d_Direct_Truck,
    c.[CustomerID] AS c_CustomerID,
    c.[MBL_ID] AS c_MBL_ID,
    c.[ContainerID] AS c_ContainerID,
    c.[Status] AS c_Status,
    c.[TransmissionTimestamp] AS c_TransmissionTimestamp,
    c.[Voyage] AS c_Voyage,
    c.[ContainerSize] AS c_ContainerSize,
    c.[Broker] AS c_Broker,
    c.[Carrier] AS c_Carrier,
    c.[Vessel] AS c_Vessel,
    c.[PortOfDischarge_Lima] AS c_PortOfDischarge_Lima,
    c.[ETA_PortOfDischarge] AS c_ETA_PortOfDischarge,
    c.[PackingMethod] AS c_PackingMethod,
    c.[TotalWeight] AS c_TotalWeight,
    c.[AdvertFlag] AS c_AdvertFlag,
    c.[RealAdvertFlag] AS c_RealAdvertFlag,
    c.[EarliestAdvertDate] AS c_EarliestAdvertDate,
    c.[EarliestRealAdvertDate] AS c_EarliestRealAdvertDate,
    c.[todo] AS c_todo,
    c.[last_eventID] AS c_last_eventID,
    c.[PortOfLoading_Lima] AS c_PortOfLoading_Lima,
    c.[ETD_PortOfLoading] AS c_ETD_PortOfLoading,
    c.[Terminal_Inland_Vorgabe_NTL] AS c_Terminal_Inland_Vorgabe_NTL,
    c.[ETA_Terminal_Inland] AS c_ETA_Terminal_Inland,
    c.[DeliveryAddress] AS c_DeliveryAddress,
    c.[ETA_DeliveryAddress] AS c_ETA_DeliveryAddress,
    c.[Terminal_Inland_CundA] AS c_Terminal_Inland_CundA,
    c.[Transport_Mode_Terminal_Vorgabe_NTL] AS c_Transport_Mode_Terminal_Vorgabe_NTL,
    c.[Transport_Mode_final_DeliveryAddress] AS c_Transport_Mode_final_DeliveryAddress,
    c.[ATA_DeliveryAddress] AS c_ATA_DeliveryAddress,
    c.[transport_Dispo_ID] AS c_transport_Dispo_ID,
    c.[Condition] AS c_Condition,
    c.[into_CW1] AS c_into_CW1,
    c.[to_Customer] AS c_to_Customer,
    c.[to_Transporter] AS c_to_Transporter,
    c.[DropOff_Terminal] AS c_DropOff_Terminal,
    c.[Terminal_PortOfDischarge] AS c_Terminal_PortOfDischarge,
    c.[Pincode] AS c_Pincode,
    c.[DropOff_Terminal_TIR] AS c_DropOff_Terminal_TIR,
    c.[Delivered] AS c_Delivered,
    c.[Remarks] AS c_Remarks,
    c.[HouseBill] AS c_HouseBill,
    c.[Containerverfuegbarkeit] AS c_Containerverfuegbarkeit,
    c.[ETA_Service_Provider] AS c_ETA_Service_Provider,
    c.[ATA_Terminal_Inland] AS c_ATA_Terminal_Inland,
    c.[ATD_Terminal_Inland] AS c_ATD_Terminal_Inland,
    c.[Return_Date_to_Depot] AS c_Return_Date_to_Depot,
    c.[ATD_Seaport] AS c_ATD_Seaport,
    c.[ETD_Seaport] AS c_ETD_Seaport,
    c.[ETA_Seaport] AS c_ETA_Seaport,
    c.[ATA_Seaport] AS c_ATA_Seaport,
    c.[final_date_delivery_address] AS c_final_date_delivery_address,
    c.[ctv_booking_id] AS c_ctv_booking_id,
    c.[CTV_ETA_PortOfDischarge] AS c_CTV_ETA_PortOfDischarge,
    c.[PortOfDischarge_UNLOCO] AS c_PortOfDischarge_UNLOCO,
    c.[PortOfLoading_UNLOCO] AS c_PortOfLoading_UNLOCO,
    c.[ATA_DropOff_Terminal] AS c_ATA_DropOff_Terminal,
    c.[DeliveryAddress_CTV] AS c_DeliveryAddress_CTV,
    c.[PortOfDischarge_UNLOCO_CTV] AS c_PortOfDischarge_UNLOCO_CTV,
    c.[Transport_Mode_Terminal_CTV] AS c_Transport_Mode_Terminal_CTV,
    c.[Carrier_CTV] AS c_Carrier_CTV,
    c.[customs_document_number] AS c_customs_document_number,
    c.[customs_document_type] AS c_customs_document_type,
    c.[Terminal_Inland_CTV] AS c_Terminal_Inland_CTV,
    c.[ETD_Pickup_PortOfDischarge] AS c_ETD_Pickup_PortOfDischarge,
    c.[ATD_Pickup_PortOfDischarge] AS c_ATD_Pickup_PortOfDischarge,
    c.[pinRequested] AS c_pinRequested,
    c.[pinState] AS c_pinState,
    c.[nationalTransportState] AS c_nationalTransportState,
    c.[finalDeliveryState] AS c_finalDeliveryState,
    c.[emptyReturnState] AS c_emptyReturnState,
    c.[ETA_Terminal_Inland_Vorgabe_NTL] AS c_ETA_Terminal_Inland_Vorgabe_NTL,
    c.[DeliveryInfo_send_to_CTV] AS c_DeliveryInfo_send_to_CTV,
    c.[Advert_Timing_Status] AS Advert_Timing_Status,
    c.[new] AS c_new, 
    tm.Wert AS MBL_No,
    tm2.Wert AS Container_No,
    c.Direct_Truck AS c_Direct_Truck,
    (
        SELECT COUNT(*)
        FROM transport_messages msg
        WHERE msg.Transport_Dispo_ID = d.Transport_Dispo_ID
    ) AS error_count
FROM dbo.Transport_Dispo d
LEFT JOIN dbo.Transport_Dispo_clone AS c
    ON d.transport_Dispo_ID = c.transport_Dispo_ID
JOIN dbo.Transport_Mapping tm
    ON tm.Schluessel = d.MBL_ID AND tm.Typ = 'M'
JOIN dbo.Transport_Mapping tm2
    ON tm2.Schluessel = d.ContainerID AND tm2.Typ = 'C';